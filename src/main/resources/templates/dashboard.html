<!DOCTYPE html>
<html lang="hr" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nadzorna ploča | Praćenje Potrošnje Vode</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link rel="stylesheet" href="/css/dashboard.css">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">Praćenje Potrošnje Vode</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="#"><i class="bi bi-speedometer2"></i> Nadzorna ploča</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#"><i class="bi bi-geo-alt"></i> Lokacije</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#"><i class="bi bi-droplet"></i> Potrošnja vode</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" th:href="@{/reports}"><i class="bi bi-graph-up"></i> Izvještaji</a>
                    </li>
                </ul>
                <ul class="navbar-nav">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown">
                            <i class="bi bi-person-circle"></i> <span th:text="${session.userName}">Korisnik</span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="#"><i class="bi bi-person"></i> Profil</a></li>
                            <li><a class="dropdown-item" href="#"><i class="bi bi-gear"></i> Postavke</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" th:href="@{/logout}"><i class="bi bi-box-arrow-right"></i> Odjava</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Flash Messages -->
    <div class="container mt-3">
        <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
            <span th:text="${error}">Error message</span>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        <div th:if="${success}" class="alert alert-success alert-dismissible fade show" role="alert">
            <span th:text="${success}">Success message</span>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    </div>

    <div class="container dashboard-container">
        <div class="row mb-4">
            <div class="col-md-12">
                <h2>Dobrodošli, <span th:text="${session.userName}">Korisnik</span>!</h2>
                <p class="text-muted">Pregled vaše potrošnje vode</p>
            </div>
        </div>

        <div class="row mb-4">
            <div class="col-md-4">
                <div class="card text-center">
                    <div class="card-header">Ukupna potrošnja</div>
                    <div class="card-body">
                        <h3 class="card-title" th:text="${#numbers.formatDecimal(totalConsumption, 1, 3) + ' litara'}">0 litara</h3>
                        <p class="card-text">Ukupna potrošnja vode</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card text-center">
                    <div class="card-header">Broj lokacija</div>
                    <div class="card-body">
                        <h3 class="card-title" th:text="${locations != null ? locations.size() : '0'}">0</h3>
                        <p class="card-text">Registrirane lokacije</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card text-center">
                    <div class="card-header">Prosječna potrošnja</div>
                    <div class="card-body">
                        <h3 class="card-title" th:text="${#numbers.formatDecimal(averageConsumption, 1, 3) + ' litara/unos'}">0 litara/dan</h3>
                        <p class="card-text">Prosječna potrošnja po unosu</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <span>Vaše lokacije</span>
                        <button class="btn btn-sm btn-add" data-bs-toggle="modal" data-bs-target="#addLocationModal">
                            <i class="bi bi-plus-circle"></i> Dodaj lokaciju
                        </button>
                    </div>
                    <div class="card-body">
                        <div th:if="${!hasLocations}" class="alert alert-info">
                            Nemate dodanih lokacija. Dodajte svoju prvu lokaciju klikom na gumb "Dodaj lokaciju".
                        </div>
                        <div th:if="${hasLocations}" class="list-group">
                            <!-- Link to show all locations -->
                            <a href="/dashboard" class="list-group-item list-group-item-action" th:classappend="${selectedLocationId == null ? 'active' : ''}">
                                <div class="d-flex w-100 justify-content-between">
                                    <h5 class="mb-1">Sve lokacije</h5>
                                </div>
                                <p class="mb-1">Prikaži potrošnju za sve lokacije</p>
                            </a>
                            
                            <!-- Individual location links -->
                            <div th:each="location : ${locations}" class="mb-2">
                                <a th:href="@{/dashboard(locationId=${location.id}, sortDesc=${sortDesc})}" 
                                   class="list-group-item list-group-item-action"
                                   th:classappend="${location.id == selectedLocationId ? 'active' : ''}">
                                    <div class="d-flex w-100 justify-content-between">
                                        <h5 class="mb-1" th:text="${location.name}">Naziv lokacije</h5>
                                        <button type="button" class="btn btn-sm btn-outline-primary manage-measure-points-btn"
                                                th:data-location-id="${location.id}"
                                                th:data-location-name="${location.name}"
                                                title="Upravljanje mjernim mjestima">
                                            <i class="bi bi-gear-fill"></i> Mjerna mjesta
                                        </button>
                                    </div>
                                    <p class="mb-1" th:text="${location.address}">Adresa lokacije</p>
                                </a>
                                
                                <!-- Measure points for this location -->
                                <div th:if="${location.id == selectedLocationId && hasMeasurePoints}" 
                                     class="list-group ms-4 mt-2">
                                    <a th:each="measurePoint : ${measurePoints}" 
                                       th:href="@{/dashboard(locationId=${location.id}, measurePointId=${measurePoint.id}, sortDesc=${sortDesc})}" 
                                       class="list-group-item list-group-item-action measure-point-item"
                                       th:classappend="${measurePoint.id == selectedMeasurePointId ? 'active' : ''}">
                                        <div class="d-flex w-100 justify-content-between">
                                            <h6 class="mb-1" th:text="${measurePoint.name}">Naziv mjernog mjesta</h6>
                                        </div>
                                        <p class="mb-1 small" th:if="${measurePoint.description}" th:text="${measurePoint.description}">Opis mjernog mjesta</p>
                                    </a>
                                </div>
                                <div th:if="${location.id == selectedLocationId && !hasMeasurePoints}" class="ms-4 mt-2">
                                    <div class="alert alert-info py-2">
                                        Nema mjernih mjesta za ovu lokaciju. Dodajte mjerna mjesta klikom na <i class="bi bi-gear-fill"></i>.
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <div class="d-flex align-items-center">
                            <span th:if="${selectedLocationName == null}">Nedavna potrošnja vode</span>
                            <span th:if="${selectedLocationName != null && selectedMeasurePointName == null}" 
                                  th:text="'Potrošnja vode - ' + ${selectedLocationName}">Potrošnja vode - Lokacija</span>
                            <span th:if="${selectedMeasurePointName != null}" 
                                  th:text="'Potrošnja vode - ' + ${selectedLocationName} + ' (' + ${selectedMeasurePointName} + ')'">
                                  Potrošnja vode - Lokacija (Mjerno mjesto)
                            </span>
                        </div>
                        <div class="d-flex justify-content-between align-items-center">
                            <div class="d-flex align-items-center">
                                <a th:if="${hasConsumptions}" 
                                   th:href="@{/dashboard(locationId=${selectedLocationId}, sortDesc=${!sortDesc})}" 
                                   class="btn btn-sm me-2" 
                                   title="Promijeni redoslijed sortiranja">
                                    <i class="bi" th:classappend="${sortDesc ? 'bi-sort-down' : 'bi-sort-up'}"></i>
                                </a>
                            </div>
                            <div class="d-flex justify-content-between align-items-center">
                                <button th:if="${hasLocations}" class="btn btn-sm btn-add" data-bs-toggle="modal" data-bs-target="#addConsumptionModal">
                                    <i class="bi bi-plus-circle"></i> Dodaj potrošnju
                                </button>
                                <button th:unless="${hasLocations}" class="btn btn-sm btn-add" disabled>
                                    <i class="bi bi-plus-circle"></i> Dodaj potrošnju
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <div th:if="${!hasConsumptions}" class="alert alert-info">
                            Nema zabilježene potrošnje vode. Dodajte svoju prvu potrošnju klikom na gumb "Dodaj potrošnju".
                        </div>
                        <div th:if="${hasConsumptions}" class="table-responsive consumption-table">
                            <table class="table table-hover table-responsive-card">
                                <thead>
                                    <tr>
                                        <th>Datum</th>
                                        <th th:if="${selectedLocationName != null}">Mjerno mjesto</th>
                                        <th th:if="${selectedLocationName == null}">Lokacija</th>
                                        <th>Očitanje brojila</th>
                                        <th>Potrošnja u periodu</th>
                                        <th>Napomena</th>
                                        <th>Akcije</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr th:each="consumption : ${waterConsumptions}">
                                        <td data-label="Datum" th:text="${#temporals.format(consumption.date, 'dd.MM.yyyy')}">01.01.2023</td>
                                        <td data-label="Mjerno mjesto" th:if="${selectedLocationName != null}" th:text="${consumption.measurePoint.name}">Mjerno mjesto</td>
                                        <td data-label="Lokacija" th:if="${selectedLocationName == null}" th:text="${consumption.measurePoint.location.name}">Lokacija</td>
                                        <td>
                                            <div class="d-flex flex-column">
                                                <!-- Total Meter Reading -->
                                                <span th:if="${consumption.meterReading != null}" 
                                                      th:text="${'Ukupno: ' + #numbers.formatDecimal(consumption.meterReading, 1, 3) + ' ' + consumption.unit}"
                                                      class="mb-1">
                                                    Ukupno: 100.000 m³
                                                </span>
                                                
                                                <!-- Hot Water Meter Reading -->
                                                <span th:if="${consumption.hotWaterMeterReading != null}" 
                                                      th:text="${'Topla: ' + #numbers.formatDecimal(consumption.hotWaterMeterReading, 1, 3) + ' ' + consumption.unit}"
                                                      class="text-hot-water mb-1">
                                                    <i class="bi bi-thermometer-high"></i> Topla: 50.000 m³
                                                </span>
                                                
                                                <!-- Cold Water Meter Reading -->
                                                <span th:if="${consumption.coldWaterMeterReading != null}" 
                                                      th:text="${'Hladna: ' + #numbers.formatDecimal(consumption.coldWaterMeterReading, 1, 3) + ' ' + consumption.unit}"
                                                      class="text-cold-water">
                                                    <i class="bi bi-thermometer-low"></i> Hladna: 50.000 m³
                                                </span>
                                                
                                                <!-- If no meter readings -->
                                                <span th:if="${consumption.meterReading == null && consumption.hotWaterMeterReading == null && consumption.coldWaterMeterReading == null}">
                                                    -
                                                </span>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="d-flex flex-column">
                                                <!-- Total Period Consumption -->
                                                <span th:if="${consumption.periodConsumption != null}" 
                                                      th:text="${'Ukupno: ' + #numbers.formatDecimal(consumption.periodConsumption, 1, 3) + ' ' + consumption.unit}"
                                                      class="mb-1">
                                                    Ukupno: 0.500 m³
                                                </span>
                                                
                                                <!-- Hot Water Period Consumption -->
                                                <span th:if="${consumption.hotWaterPeriodConsumption != null}" 
                                                      th:text="${'Topla: ' + #numbers.formatDecimal(consumption.hotWaterPeriodConsumption, 1, 3) + ' ' + consumption.unit}"
                                                      class="text-hot-water mb-1">
                                                    <i class="bi bi-thermometer-high"></i> Topla: 0.200 m³
                                                </span>
                                                
                                                <!-- Cold Water Period Consumption -->
                                                <span th:if="${consumption.coldWaterPeriodConsumption != null}" 
                                                      th:text="${'Hladna: ' + #numbers.formatDecimal(consumption.coldWaterPeriodConsumption, 1, 3) + ' ' + consumption.unit}"
                                                      class="text-cold-water">
                                                    <i class="bi bi-thermometer-low"></i> Hladna: 0.300 m³
                                                </span>
                                                
                                                <!-- Legacy support for old data -->
                                                <span th:if="${consumption.periodConsumption == null && consumption.hotWaterPeriodConsumption == null && consumption.coldWaterPeriodConsumption == null}">
                                                    <span th:if="${consumption.amount != null}" 
                                                          th:text="${'Ukupno: ' + #numbers.formatDecimal(consumption.amount, 1, 2) + ' ' + consumption.unit}"
                                                          class="mb-1">
                                                        Ukupno: 15 m³
                                                    </span>
                                                    
                                                    <span th:if="${consumption.hotWaterPeriodConsumption != null}" 
                                                          th:text="${'Topla: ' + #numbers.formatDecimal(consumption.hotWaterPeriodConsumption, 1, 2) + ' ' + consumption.unit}"
                                                          class="text-hot-water mb-1">
                                                        <i class="bi bi-thermometer-high"></i> Topla: 5 m³
                                                    </span>
                                                    
                                                    <span th:if="${consumption.coldWaterPeriodConsumption != null}" 
                                                          th:text="${'Hladna: ' + #numbers.formatDecimal(consumption.coldWaterPeriodConsumption, 1, 2) + ' ' + consumption.unit}"
                                                          class="text-cold-water">
                                                        <i class="bi bi-thermometer-low"></i> Hladna: 10 m³
                                                    </span>
                                                </span>
                                            </div>
                                        </td>
                                        <td th:text="${consumption.notes}">Napomena</td>
                                        <td>
                                            <div class="btn-group btn-group-sm">
                                                <button class="btn btn-sm btn-primary edit-consumption-btn" 
                                                        data-id="${consumption.id}"
                                                        th:attr="data-id=${consumption.id},
                                                                data-measure-point-id=${consumption.measurePoint.id},
                                                                data-date=${consumption.date},
                                                                data-hot-water-meter-reading=${consumption.hotWaterMeterReading},
                                                                data-cold-water-meter-reading=${consumption.coldWaterMeterReading},
                                                                data-unit=${consumption.unit},
                                                                data-notes=${consumption.notes}">
                                                    <i class="bi bi-pencil"></i>
                                                </button>
                                                <a th:href="@{/consumption/delete/{id}(id=${consumption.id})}" 
                                                   class="btn btn-sm btn-danger delete-consumption-btn"
                                                   onclick="return confirm('Jeste li sigurni da želite obrisati ovaj unos potrošnje?')">
                                                    <i class="bi bi-trash"></i>
                                                </a>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
    </div>

    <!-- Footer -->
    <div th:replace="fragments/footer :: footer"></div>

    <!-- Add Location Modal -->
    <div class="modal fade" id="addLocationModal" tabindex="-1" aria-labelledby="addLocationModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addLocationModalLabel">Dodaj novu lokaciju</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form th:action="@{/locations/add}" method="post">
                        <div class="mb-3">
                            <label for="locationName" class="form-label">Naziv lokacije</label>
                            <input type="text" class="form-control" id="locationName" name="name" required>
                        </div>
                        <div class="mb-3">
                            <label for="locationAddress" class="form-label">Adresa</label>
                            <input type="text" class="form-control" id="locationAddress" name="address">
                        </div>
                        
                        <!-- Default Measure Point -->
                        <div class="card mb-3 border-primary">
                            <div class="card-header bg-primary text-white">
                                <i class="bi bi-geo-alt"></i> Početno mjerno mjesto
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label for="defaultMeasurePointName" class="form-label">Naziv mjernog mjesta</label>
                                    <input type="text" class="form-control" id="defaultMeasurePointName" name="defaultMeasurePointName" required>
                                    <div class="form-text">Svaka lokacija mora imati barem jedno mjerno mjesto.</div>
                                </div>
                                <div class="mb-3">
                                    <label for="defaultMeasurePointDescription" class="form-label">Opis (opcionalno)</label>
                                    <input type="text" class="form-control" id="defaultMeasurePointDescription" name="defaultMeasurePointDescription">
                                </div>
                            </div>
                        </div>
                        
                        <div class="d-grid">
                            <button type="submit" class="btn btn-primary">Spremi lokaciju</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Consumption Modal -->
    <div class="modal fade" id="addConsumptionModal" tabindex="-1" aria-labelledby="addConsumptionModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addConsumptionModalLabel">Dodaj potrošnju vode</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form th:action="@{/consumption/add}" method="post">
                        <div class="mb-3">
                            <label for="locationSelect" class="form-label">Lokacija</label>
                            <select class="form-select" id="locationSelect" name="locationId" required>
                                <option value="" selected disabled>Odaberite lokaciju</option>
                                <option th:each="location : ${locations}" 
                                        th:value="${location.id}" 
                                        th:text="${location.name}"
                                        th:selected="${location.id == selectedLocationId}">Naziv lokacije</option>
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label for="measurePointSelect" class="form-label">Mjerno mjesto</label>
                            <select class="form-select" id="measurePointSelect" name="measurePointId" required>
                                <option value="" selected disabled>Prvo odaberite lokaciju</option>
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label for="consumptionDate" class="form-label">Datum</label>
                            <input type="date" class="form-control" id="consumptionDate" name="date" required>
                        </div>
                        
                        <!-- Hot Water Consumption -->
                        <div class="card mb-3 border-danger">
                            <div class="card-header bg-danger text-white">
                                <i class="bi bi-thermometer-high"></i> Topla voda
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label for="hotWaterMeterReading" class="form-label">Očitanje brojila tople vode</label>
                                    <input type="number" class="form-control" id="hotWaterMeterReading" name="hotWaterMeterReading" min="0" step="0.001" placeholder="Unesite očitanje s brojila" required>
                                    <small class="form-text text-muted">Unesite trenutno očitanje s brojila (kumulativna vrijednost)</small>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Cold Water Consumption -->
                        <div class="card mb-3 border-info">
                            <div class="card-header bg-info text-white">
                                <i class="bi bi-thermometer-low"></i> Hladna voda
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label for="coldWaterMeterReading" class="form-label">Očitanje brojila hladne vode</label>
                                    <input type="number" class="form-control" id="coldWaterMeterReading" name="coldWaterMeterReading" min="0" step="0.001" placeholder="Unesite očitanje s brojila" required>
                                    <small class="form-text text-muted">Unesite trenutno očitanje s brojila (kumulativna vrijednost)</small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="unit" class="form-label">Mjerna jedinica</label>
                            <select class="form-select" id="unit" name="unit">
                                <option value="m³" selected>Kubični metri (m³)</option>
                                <option value="litara">Litara</option>
                                <option value="galona">Galona</option>
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label for="notes" class="form-label">Napomena</label>
                            <textarea class="form-control" id="notes" name="notes" rows="2"></textarea>
                        </div>
                        
                        <div class="d-grid">
                            <button type="submit" class="btn btn-primary">Spremi potrošnju</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Manage Measure Points Modal -->
    <div class="modal fade" id="manageMeasurePointsModal" tabindex="-1" aria-labelledby="manageMeasurePointsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="manageMeasurePointsModalLabel">Upravljanje mjernim mjestima</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    
                    <!-- Add Measure Point Form -->
                    <div id="addMeasurePointForm">
                        <h6 class="mt-3">Dodaj novo mjerno mjesto</h6>
                        <form id="addMeasurePointFormElement">
                            <input type="hidden" id="addMeasurePointLocationId" name="locationId" th:value="${selectedLocationId}" />
                            <div class="mb-3">
                                <label for="measurePointName" class="form-label">Naziv mjernog mjesta</label>
                                <input type="text" class="form-control" id="measurePointName" name="name" required />
                            </div>
                            <div class="mb-3">
                                <label for="measurePointDescription" class="form-label">Opis (opcionalno)</label>
                                <textarea class="form-control" id="measurePointDescription" name="description" rows="2"></textarea>
                            </div>
                            <button type="submit" class="btn btn-primary">Dodaj mjerno mjesto</button>
                        </form>
                    </div>
                    
                    <!-- Edit Measure Point Form (initially hidden) -->
                    <div id="editMeasurePointForm" style="display: none;">
                        <h6 class="mt-3">Uredi mjerno mjesto</h6>
                        <form id="editMeasurePointFormElement">
                            <input type="hidden" id="editMeasurePointId" name="id" />
                            <input type="hidden" id="editLocationId" name="locationId" th:value="${selectedLocationId}" />
                            <div class="mb-3">
                                <label for="editMeasurePointName" class="form-label">Naziv mjernog mjesta</label>
                                <input type="text" class="form-control" id="editMeasurePointName" name="name" required />
                            </div>
                            <div class="mb-3">
                                <label for="editMeasurePointDescription" class="form-label">Opis (opcionalno)</label>
                                <textarea class="form-control" id="editMeasurePointDescription" name="description" rows="2"></textarea>
                            </div>
                            <div class="d-flex justify-content-between">
                                <button type="button" id="cancelEditBtn" class="btn btn-secondary">Odustani</button>
                                <button type="submit" class="btn btn-primary">Spremi promjene</button>
                            </div>
                        </form>
                    </div>
                    
                    <!-- Measure Points List -->
                    <h6 class="mt-4">Postojeća mjerna mjesta</h6>
                    <div class="table-responsive">
                        <table class="table table-striped table-hover">
                            <thead>
                                <tr>
                                    <th>Naziv</th>
                                    <th>Opis</th>
                                    <th>Akcije</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:if="${measurePoints == null || measurePoints.isEmpty()}">
                                    <td colspan="3" class="text-center">Nema mjernih mjesta za ovu lokaciju</td>
                                </tr>
                                <tr th:each="point : ${measurePoints}" th:unless="${measurePoints == null || measurePoints.isEmpty()}">
                                    <td th:text="${point.name}">Mjerno mjesto</td>
                                    <td th:text="${point.description != null ? point.description : '-'}">Opis</td>
                                    <td>
                                        <button class="btn btn-sm btn-primary edit-measure-point-btn" 
                                                th:data-id="${point.id}" 
                                                th:data-name="${point.name}" 
                                                th:data-description="${point.description != null ? point.description : ''}">
                                            <i class="bi bi-pencil"></i> Uredi
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Zatvori</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Consumption Modal -->
    <div class="modal fade" id="editConsumptionModal" tabindex="-1" aria-labelledby="editConsumptionModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editConsumptionModalLabel">Uredi potrošnju vode</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form th:action="@{/consumption/edit}" method="post">
                        <input type="hidden" id="editConsumptionId" name="id" />
                        <div class="mb-3">
                            <label for="editLocationSelect" class="form-label">Lokacija</label>
                            <select class="form-select" id="editLocationSelect" name="locationId" required>
                                <option value="" selected disabled>Odaberite lokaciju</option>
                                <option th:each="location : ${locations}" 
                                        th:value="${location.id}" 
                                        th:text="${location.name}">Naziv lokacije</option>
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label for="editMeasurePointSelect" class="form-label">Mjerno mjesto</label>
                            <select class="form-select" id="editMeasurePointSelect" name="measurePointId" required>
                                <option value="" selected disabled>Prvo odaberite lokaciju</option>
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label for="editConsumptionDate" class="form-label">Datum</label>
                            <input type="date" class="form-control" id="editConsumptionDate" name="date" required>
                        </div>
                        
                        <!-- Hot Water Consumption -->
                        <div class="card mb-3 border-danger">
                            <div class="card-header bg-danger text-white">
                                <i class="bi bi-thermometer-high"></i> Topla voda
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label for="editHotWaterMeterReading" class="form-label">Očitanje brojila tople vode</label>
                                    <input type="number" class="form-control" id="editHotWaterMeterReading" name="hotWaterMeterReading" min="0" step="0.001" placeholder="Unesite očitanje s brojila" required>
                                    <small class="form-text text-muted">Unesite trenutno očitanje s brojila (kumulativna vrijednost)</small>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Cold Water Consumption -->
                        <div class="card mb-3 border-info">
                            <div class="card-header bg-info text-white">
                                <i class="bi bi-thermometer-low"></i> Hladna voda
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label for="editColdWaterMeterReading" class="form-label">Očitanje brojila hladne vode</label>
                                    <input type="number" class="form-control" id="editColdWaterMeterReading" name="coldWaterMeterReading" min="0" step="0.001" placeholder="Unesite očitanje s brojila" required>
                                    <small class="form-text text-muted">Unesite trenutno očitanje s brojila (kumulativna vrijednost)</small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="editUnit" class="form-label">Mjerna jedinica</label>
                            <select class="form-select" id="editUnit" name="unit">
                                <option value="m³" selected>Kubični metri (m³)</option>
                                <option value="litara">Litara</option>
                                <option value="galona">Galona</option>
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label for="editNotes" class="form-label">Napomena</label>
                            <textarea class="form-control" id="editNotes" name="notes" rows="2"></textarea>
                        </div>
                        
                        <div class="d-grid">
                            <button type="submit" class="btn btn-primary">Spremi potrošnju</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap and other scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.min.js"></script>
    <script src="/js/dashboard.js"></script>
</body>
</html>
